services:
  - type: web
    name: vending-machine-app
    env: docker
    dockerfilePath: Dockerfile  # If you have a Dockerfile, keep this line
    buildCommand: |
      # Build frontend
      cd VendingMachineApp.Client
      npm install
      npm run build:prod
      # Copy frontend build to backend wwwroot
      mkdir -p ../Vending-Machine-App/Vending-Machine-App/wwwroot
      cp -r dist/vending-machine-app.client/* ../Vending-Machine-App/Vending-Machine-App/wwwroot
      # Go back to the root of the project to build the backend
      cd ../Vending-Machine-App  # VERY IMPORTANT!
      # Build backend
      dotnet publish Vending-Machine-App/Vending-Machine-App/Vending-Machine-App.csproj -c Release -o /app/out --no-restore # Match Dockerfile output path and .csproj path
    startCommand: dotnet Vending-Machine-App.dll
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
    ports:
      - 8080